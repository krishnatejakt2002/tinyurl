<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Link Stats</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; }
    h1, h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <h1>Link Stats</h1>
  <div>
    <label>Enter short code: </label>
    <input type="text" id="shortCodeInput" placeholder="e.g., abc123">
    <button onclick="loadStats()">View Stats</button>
  </div>

  <div id="statsContainer" style="margin-top:20px;"></div>

  <script>
    const BASE_URL = window.location.origin;

    async function loadStats() {
      const shortCode = document.getElementById('shortCodeInput').value.trim();
      if (!shortCode) return alert('Enter a short code');

      try {
        const response = await fetch(`${BASE_URL}/code/${shortCode}`);
        if (response.status === 404) {
          document.getElementById('statsContainer').innerHTML = '<p>Short code not found.</p>';
          return;
        }

        const data = await response.json();
        const url = data.url;
        const clicks = data.click_logs;

        let html = `
          <h2>Short Code: ${url.short_code}</h2>
          <p>Original URL: <a href="${url.original_url}" target="_blank">${url.original_url}</a></p>
          <p>Total Clicks: ${url.click_count}</p>
          <p>Last Clicked: ${url.last_clicked_at ? new Date(url.last_clicked_at).toLocaleString() : '-'}</p>
          <h3>Click Logs</h3>
          <table>
            <thead>
              <tr>
                <th>Time</th>
                <th>IP Address</th>
                <th>User Agent</th>
              </tr>
            </thead>
            <tbody>
        `;

        clicks.forEach(c => {
          html += `
            <tr>
              <td>${new Date(c.click_time).toLocaleString()}</td>
              <td>${c.ip_address || '-'}</td>
              <td>${c.user_agent || '-'}</td>
            </tr>
          `;
        });

        html += `</tbody></table>`;
        document.getElementById('statsContainer').innerHTML = html;

      } catch (err) {
        console.error(err);
        alert('Failed to load stats');
      }
    }
  </script>
</body>
</html>
